name: Upload to IPFS 
# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the v7 branch
  push:
    branches: [ v7 ]
  pull_request:
    branches: [ v7 ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build and Test
    steps:
    - uses: actions/checkout@v2
      name: Check out repository
    - uses: actions/setup-node@v1
      name: Set up Node.js
      with:
        node-version: 16
    - run: |
        yarn install
        yarn build
      name: Build
    - uses: kota-yata/ipfs-action@v1.0.4
      name: Deploy to Pinata, and add DNSlink to Vercel
      with:
        path: ./build
        verbose: true
        service: ipfs
        timeout: 60000
        pinataKey: ${{ secrets.PINATA_KEY }}
        pinataSecret: ${{ secrets.PINATA_SECRET }}
        vercelDomain: kota-yata.com
        vercelToken: ${{ secrets.VERCEL_TOKEN }}
  
